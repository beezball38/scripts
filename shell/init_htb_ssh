#!/bin/bash

# Path to your SSH config file
SSH_CONFIG="$HOME/.ssh/config"

# Alias name for your HackTheBox lab system
ALIAS_NAME="htb"

# Check if the SSH config file exists
if [[ ! -f "$SSH_CONFIG" ]]; then
    echo "SSH config file not found at $SSH_CONFIG. Please create it first."
    exit 1
fi

# Check if the alias exists in the SSH config file
if ! grep -q "Host $ALIAS_NAME" "$SSH_CONFIG"; then
    echo "Alias '$ALIAS_NAME' not found in $SSH_CONFIG. Please add it manually first."
    exit 1
fi

# Prompt the user for the new SSH address
read -p "Enter the new SSH address for your HackTheBox lab system: " NEW_SSH_ADDRESS

# Update the existing alias with the new SSH address
# macOS requires an argument for the -i flag (creates a backup with .bak extension)
sed -i.bak "/Host $ALIAS_NAME/,/HostName/ s/HostName .*/HostName $NEW_SSH_ADDRESS/" "$SSH_CONFIG"

# Check if the update was successful
if grep -q "HostName $NEW_SSH_ADDRESS" "$SSH_CONFIG"; then
    echo "Successfully updated SSH address for alias '$ALIAS_NAME' to '$NEW_SSH_ADDRESS'."
else
    echo "Failed to update SSH address. Please check your SSH config file."
fi
